<html>
<head></head>
<body>
	<canvas id='bitmap' width ='400' height = '400'></canvas>
	<script>
		var time;
		var CIRCLE_TIME = 1 * 60 * 200;
		var CIRCLE_RADIUS = 50;
		var FIELD_SIZE = 75;
		var mutex = false;
		var bitmap = document.getElementById("bitmap").getContext("2d");
		start();
		setInterval(loop,300);
		//setInterval(function(){test_clear(bitmap);},300);
		function start()
		{
			time = new Date().getTime();
		}
		function loop()
		{
			var element = document.getElementById("bitmap");
			var bitmap = element.getContext("2d");

			// Clear previous vectors
			bitmap.clearRect(0,0,400,400);
			console.log(element.width,element.height);

			// Gets the circular field vector
			var angle = 360 * get_ratio();
			angle = radians(angle);
			var circle = [Math.sin(angle)*CIRCLE_RADIUS,Math.cos(angle)*CIRCLE_RADIUS];
			var zero = [200,200];
			var vector = circular_field(angle);

			// Makes adjustments between vectors and canvas points
			circle[0] += zero[0]
			circle[1] = (circle[1]+zero[1]);
			vector[0] += circle[0];
			vector[1] = (vector[1]+circle[1]);
			// Draws the vector
			bitmap.beginPath();
			bitmap.strokeStyle = "000000";
			bitmap.moveTo(circle[0], circle[1]);
			bitmap.lineTo(vector[0], vector[1]);
			bitmap.stroke();
			// Draws the circle
			bitmap.beginPath();
			bitmap.arc(zero[0], zero[1], CIRCLE_RADIUS, 0, 2 * Math.PI);
			bitmap.stroke();
		
		}
		function clear_lines()
		{
			while(mutex);
			mutex = true;
			var context = document.getElementById("bitmap").getContext("2d");
			context.fillStyle = "white";
			context.fillRect(0,0,400,400);
			conseole.log("cleaned");
			mutex = false;
		}
		function circular_field(angle)
		{
			var a = Math.sin(angle);
			var b = Math.cos(angle);
			var x = 0, y = 0;
			if(b!=0)
			{
				var sign = b / Math.abs(b);
				x = 1 * sign;
				y = -a / b * sign;
				var length = Math.sqrt(x*x + y*y);
				x /= length;
				y /= length;
				x *= FIELD_SIZE;
				y *= FIELD_SIZE;
			}
			else
			{
				x = 0;
				y = -a * FIELD_SIZE;
			}
			var arr = [Math.round(x) ,Math.round(y)];
			return arr;
		}
		function radians(angle)
		{
			return angle * (Math.PI / 180)
		}
		function get_ratio()
		{
			var t = new Date().getTime();
			var span = ((t - time) % CIRCLE_TIME) / CIRCLE_TIME;
			return span; 
		}
	</script>
</body>
</html>
